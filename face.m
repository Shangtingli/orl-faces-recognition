warning('off','all')
npersons=40;%????40????????  
dim_PCA=40;%??????dim_PCA??
gamma=0.01; %svm????
c=50;  %svm????



global edit2;
global imgrow;  
global imgcol;  
imgrow=112;  
imgcol=92;  
  
set(edit2,'string','????????????......')%????????????edit2??????????  
drawnow     %????????????????????????????????????????????????????????????  
[f_matrix, RealClassTrain] =ReadFace(npersons,0);%????????????  
nfaces=size(f_matrix,1);%??????????????  
  
set(edit2,'string','????????PCA????????......')  
drawnow  
mA=mean(f_matrix);  
[pcaface,V]=fastPCA(f_matrix,dim_PCA,mA);%????????????????????  


%% ????????%%%%%%%%%%%%%%
%  a = reshape(mA,[112,92]);
%  imshow(uint8(a))
%  b = pcaface*V';
%  c = reshape(b(1,:)+mA,[112,92]);
%  imshow(uint8(c))
%%%%%%%%%%%%%%%%%%%%

% set(edit2,'string','??????????????......')  
% drawnow  
% lowvec=min(pcaface);  
% upvec=max(pcaface);  
% pcaface = scaling( pcaface,lowvec,upvec); 
  
set(edit2,'string','????????????????????????????????????????......')  
drawnow  
model = my_train( pcaface,RealClassTrain,gamma,c);
save('recognize.mat','model','npersons','dim_PCA','mA','V');  


class = my_predict(model,pcaface,npersons);  
accuracy=sum(class(:)==RealClassTrain(:))/length(class);  
msgbox(['????????????',num2str(accuracy*100),'%??'])

  
set(edit2,'string','????????????......')  
drawnow  
[testface,realclass]=ReadFace(npersons,1);  
  
set(edit2,'string','????????????????......')  
drawnow  
m=size(testface,1);  
for i=1:m  
    testface(i,:)=testface(i,:)-mA;  
end  
pcatestface=testface*V;  
  
% set(edit2,'string','??????????????......')  
% drawnow  
% pcatestface = scaling(pcatestface,lowvec,upvec);  
  
set(edit2,'string','????????????????????????????......')  
drawnow  
class = my_predict(model,pcatestface,npersons);
set(edit2,'string','??????????????????????????????????????') 
accuracy = sum(class(:)==realclass(:))/length(class);
msgbox(['????????????',num2str(accuracy*100),'%??'])


